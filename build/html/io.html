<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

      <title>Input and Output Utilities</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="DataFile Reader and Writer Python APIs" href="datafile.html" />
  <link rel="prev" title="Avro Schema" href="schema.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">avro-docs</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#">Introduction</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="index.html" class="reference internal ">Avro Python API Documentation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="schema.html" class="reference internal ">Avro Schema</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Input and Output Utilities</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#overview" class="reference internal">Overview</a></li>
                
                  <li class="toctree-l2"><a href="#validating-avro-schema" class="reference internal">Validating Avro Schema</a></li>
                
                  <li class="toctree-l2"><a href="#datum-validation-exceptions" class="reference internal">Datum Validation Exceptions</a></li>
                
                  <li class="toctree-l2"><a href="#decoder-and-encoder-class" class="reference internal">Decoder and Encoder Class</a></li>
                
                  <li class="toctree-l2"><a href="#datumreader-and-datumwriter-class" class="reference internal">DatumReader and DatumWriter Class</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="datafile.html" class="reference internal ">DataFile Reader and Writer Python APIs</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Input and Output Utilities</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="schema.html"
       title="previous chapter">← Avro Schema</a>
  </li>
  <li class="next">
    <a href="datafile.html"
       title="next chapter">DataFile Reader and Writer Python APIs →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="input-and-output-utilities">
<h1>Input and Output Utilities<a class="headerlink" href="#input-and-output-utilities" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Avro provides a convenient way to represent complex data structures within schema. Avro data can be used as both input to and output, as well as the intermediate format. The Input and Output utilities includes APIs to validate schema and generic representation of the data for which schema attributes are implemented using <code class="docutils literal notranslate"><span class="pre">dict</span></code> data type.
The Input and Output utilities involves set of APIs, classes, and methods that are used in serialization and deserialization of Avro schemas.</p>
<p>The set of classes and methods implements DatumReader and DatumWriter interface to read encoded Avro schemas.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://avro.apache.org/docs/1.10.2/spec.html#schema_complex">Avro Schema Specificiation</a></p>
</div>
</section>
<section id="validating-avro-schema">
<h2>Validating Avro Schema<a class="headerlink" href="#validating-avro-schema" title="Permalink to this headline">¶</a></h2>
<h3><i>Validate(expected_schema, datum)</i></h3>
<p>The function implements the validation process to check if the python datum is an instance of Avro schema. It takes two parameters <code class="docutils literal notranslate"><span class="pre">expected_schema</span></code> and <code class="docutils literal notranslate"><span class="pre">datum</span></code> to validate.</p>
<p><strong>Return type</strong>: <code class="docutils literal notranslate"><span class="pre">boolean</span></code>. <code class="docutils literal notranslate"><span class="pre">True</span></code> if datum is an instance of schema.</p>
<h4>Parameter Description</h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">expected_schema</span></code></p></td>
<td><p>It can be <code class="docutils literal notranslate"><span class="pre">null</span></code>, <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>. See, <a class="reference external" href="https://avro.apache.org/docs/1.10.2/spec.html#schema_complex">schema data types</a>.</p></td>
<td><p>Schema to validate against.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">datum</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map</span></code></p></td>
<td><p>Datum to validate.</p></td>
</tr>
</tbody>
</table>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Validate</span><span class="p">(</span><span class="n">expected_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
  <span class="n">schema_type</span> <span class="o">=</span> <span class="n">expected_schema</span><span class="o">.</span><span class="n">type</span>
  <span class="k">if</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">datum</span> <span class="ow">is</span> <span class="kc">None</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;bytes&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">INT_MIN_VALUE</span> <span class="o">&lt;=</span> <span class="n">datum</span> <span class="o">&lt;=</span> <span class="n">INT_MAX_VALUE</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;long&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">LONG_MIN_VALUE</span> <span class="o">&lt;=</span> <span class="n">datum</span> <span class="o">&lt;=</span> <span class="n">LONG_MAX_VALUE</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_schema</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;enum&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">expected_schema</span><span class="o">.</span><span class="n">symbols</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">Validate</span><span class="p">(</span><span class="n">expected_schema</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datum</span><span class="p">))</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">datum</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">Validate</span><span class="p">(</span><span class="n">expected_schema</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datum</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;union&#39;</span><span class="p">,</span> <span class="s1">&#39;error_union&#39;</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">Validate</span><span class="p">(</span><span class="n">union_branch</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">union_branch</span> <span class="ow">in</span> <span class="n">expected_schema</span><span class="o">.</span><span class="n">schemas</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">schema_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;record&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;request&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">expected_schema_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">expected_schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
        <span class="n">expected_schema_field_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Validate</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">datum_field</span> <span class="ow">in</span> <span class="n">datum</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">datum_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expected_schema_field_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">AvroTypeException</span><span class="p">(</span><span class="s1">&#39;Unknown Avro schema type: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">schema_type</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="datum-validation-exceptions">
<h2>Datum Validation Exceptions<a class="headerlink" href="#datum-validation-exceptions" title="Permalink to this headline">¶</a></h2>
<h3 style="color:red;"><i>AvroTypeException</i></h3>
<p>This exception is raised when datum is not an instance of schema.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AvroTypeException</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">AvroException</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
    <span class="n">pretty_expected</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expected_schema</span><span class="p">)),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fail_msg</span> <span class="o">=</span> <span class="s2">&quot;The datum </span><span class="si">%s</span><span class="s2"> is not an example of the schema </span><span class="si">%s</span><span class="s2">&quot;</span>\
               <span class="o">%</span> <span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">pretty_expected</span><span class="p">)</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">AvroException</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_msg</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="decoder-and-encoder-class">
<h2>Decoder and Encoder Class<a class="headerlink" href="#decoder-and-encoder-class" title="Permalink to this headline">¶</a></h2>
<p>Python API implements decoder and encoder class to read and write leaf values of Avro schema. This class supports methods that reads Avro values (<code class="docutils literal notranslate"><span class="pre">read_utf8()</span></code>, <code class="docutils literal notranslate"><span class="pre">read_long()</span></code>,and bytes). It also support reading <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">map</span></code>, and <code class="docutils literal notranslate"><span class="pre">arrays</span></code>. The decoder class contains Decoder constructors and configurations utilities.</p>
<h3><i>BinaryDecoder(object)</i></h3>
<p>Decoder Class contains methods and constructors to read leaf values. It also initializes reader python object that help decoder to read Avro values.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryDecoder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">reader</span>

</pre></div>
</div>
<h3><i>@property</i> reader(self)</h3>
<p>Reader object used by Decoder to read Avro values.</p>
<p><strong>Return type</strong>: Python object</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span>
</pre></div>
</div>
<h3><i>@property</i> reader(self,n)</h3>
<p>Decoder uses reader object to read n bytes. It takes one argument <code class="docutils literal notranslate"><span class="pre">n</span></code> that specifies the number of bytes to read.</p>
<p><strong>Return type</strong>: n bytes from the input.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">n</span>
    <span class="n">input_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">),</span> <span class="n">input_bytes</span>
    <span class="k">return</span> <span class="n">input_bytes</span>
</pre></div>
</div>
<h3><i>@property</i> read_utf8(self)</h3>
<p>Reads the string encoded as a <code class="docutils literal notranslate"><span class="pre">long</span></code> followed by the bytes of UTF-8 encoded characters.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_utf8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">input_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">input_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">exn</span><span class="p">:</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Invalid UTF-8 input bytes: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">input_bytes</span><span class="p">)</span>
      <span class="k">raise</span> <span class="n">exn</span>
</pre></div>
</div>
<h3><i>read_bytes(self)</i></h3>
<p>Reads a byte string. If there is no bytes, it returns null.</p>
<p><strong>Return type</strong>: bytes</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">nbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_long</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nbytes</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">)</span>
</pre></div>
</div>
<h3><i>read_long(self)</i></h3>
<p>Reads a long written by <code class="docutils literal notranslate"><span class="pre">write_long(self,datum)</span></code>.</p>
<p><strong>Return type</strong>:</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x7F</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">b</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span>
      <span class="n">shift</span> <span class="o">+=</span> <span class="mi">7</span>
    <span class="n">datum</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datum</span>
</pre></div>
</div>
<h3><i>BinaryEncoder(object)</i></h3>
<p>Encoder Class contains methods and constructors to write leaf values. It also initializes writer python object that help encode the <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">booloean</span></code>, and <a class="reference external" href="https://avro.apache.org/docs/1.10.2/spec.html#schema_complex">other complex types</a> of Avro schema. The Encoder class uses writer python object to write a sequence of bytes.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryEncoder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span> <span class="o">=</span> <span class="n">writer</span>
</pre></div>
</div>
<h3><i>@property</i> writer(self)</h3>
<p>Writer object use to encode values.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span>
</pre></div>
</div>
<h3><i>write(self, datum)</i></h3>
<p>Writes a sequence of bytes. It takes datum; Byte array that needs to be encoded.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Expecting bytes, got </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">datum</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</pre></div>
</div>
<h3><i>write_int(self, datum)</i></h3>
<p>Writes 32-bit int and long values. It takes <code class="docutils literal notranslate"><span class="pre">datum</span></code> as an argument which has to be encoded.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_long</span><span class="p">(</span><span class="n">datum</span><span class="p">);</span>
</pre></div>
</div>
<h3><i>write_bytes(self, datum)</i></h3>
<p>Write a byte string. It takes <code class="docutils literal notranslate"><span class="pre">datum</span></code> as an argument which has to be encoded.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_long</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datum</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

</pre></div>
</div>
<h3><i>write_utf8(self, datum)</i></h3>
<p>Writes a UTF-8 encoded string. It takes <code class="docutils literal notranslate"><span class="pre">datum</span></code> as an argument which has to be encoded.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_utf8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
    <span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="datumreader-and-datumwriter-class">
<h2>DatumReader and DatumWriter Class<a class="headerlink" href="#datumreader-and-datumwriter-class" title="Permalink to this headline">¶</a></h2>
<h3><i>DatumReader(object)</i></h3>
<p>The class represents the DatumReader interface which deserializes Avro-encoded data into a Python data structures. To validate the schema properly, multiple class level static method bound to DatumReader class.</p>
<p><strong>Return type</strong>: <code class="docutils literal notranslate"><span class="pre">boolean</span></code></p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DatumReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">check_props</span><span class="p">(</span><span class="n">schema_one</span><span class="p">,</span> <span class="n">schema_two</span><span class="p">,</span> <span class="n">prop_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">prop_list</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">schema_one</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">schema_two</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<h3><i>@staticmethod</i>match_schema</h3>
<p>Returns True if input schema matches with the output schema.</p>
<p><strong>Return type</strong>: <code class="docutils literal notranslate"><span class="pre">boolean</span></code></p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">match_schemas</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">):</span>
    <span class="n">w_type</span> <span class="o">=</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span>
    <span class="n">r_type</span> <span class="o">=</span> <span class="n">reader_schema</span><span class="o">.</span><span class="n">type</span>
    <span class="k">if</span> <span class="s1">&#39;union&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w_type</span><span class="p">,</span> <span class="n">r_type</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;error_union&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w_type</span><span class="p">,</span> <span class="n">r_type</span><span class="p">]:</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">PRIMITIVE_TYPES</span> <span class="ow">and</span> <span class="n">r_type</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">PRIMITIVE_TYPES</span>
          <span class="ow">and</span> <span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;record&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">,</span>
                                  <span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">,</span>
                                  <span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;request&#39;</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">,</span>
                                  <span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;enum&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">,</span>
                                  <span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                  <span class="n">reader_schema</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">w_type</span> <span class="o">==</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span> <span class="ow">and</span>
          <span class="n">DatumReader</span><span class="o">.</span><span class="n">check_props</span><span class="p">(</span><span class="n">writer_schema</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
                                  <span class="n">reader_schema</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])):</span>
      <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<h3><i>__init__(self,writer_schema=None, reader_schema=None)</i></h3>
<p>As defined in the Avro specification, we call the schema encoded  in the “writer’s schema”, and the schema expected by the “reader’s schema”. A <code class="docutils literal notranslate"><span class="pre">set_writer_schema</span></code> and <code class="docutils literal notranslate"><span class="pre">set_reader_schema</span></code> is defined to read and write the properties of the schema.</p>
<p><strong>Return type</strong>: Schema object</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reader_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_writer_schema</span> <span class="o">=</span> <span class="n">writer_schema</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reader_schema</span> <span class="o">=</span> <span class="n">reader_schema</span>

  <span class="c1"># read/write properties</span>
  <span class="k">def</span> <span class="nf">set_writer_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_writer_schema</span> <span class="o">=</span> <span class="n">writer_schema</span>
  <span class="n">writer_schema</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer_schema</span><span class="p">,</span>
                            <span class="n">set_writer_schema</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">set_reader_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reader_schema</span> <span class="o">=</span> <span class="n">reader_schema</span>
  <span class="n">reader_schema</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader_schema</span><span class="p">,</span>
                            <span class="n">set_reader_schema</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decoder</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">reader_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer_schema</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writer_schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader_schema</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>

</pre></div>
</div>
<h3><i>read_data(self,writer_schema,reader_schema,decoder)</i></h3>
<p>The function uses the decoder to convert the schema datum into python data structures and matches with the <code class="docutils literal notranslate"><span class="pre">reader_schema</span></code>. This help validate the schema.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">,</span> <span class="n">decoder</span><span class="p">):</span>
    <span class="c1"># schema matching</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">DatumReader</span><span class="o">.</span><span class="n">match_schemas</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">):</span>
      <span class="n">fail_msg</span> <span class="o">=</span> <span class="s1">&#39;Schemas do not match.&#39;</span>
      <span class="k">raise</span> <span class="n">SchemaResolutionException</span><span class="p">(</span><span class="n">fail_msg</span><span class="p">,</span> <span class="n">writer_schema</span><span class="p">,</span> <span class="n">reader_schema</span><span class="p">)</span>
</pre></div>
</div>
<h3 style="color:red;"><i>SchemaResolutionException</i></h3>
<p>The exception are raised when schema doesn’t matches after validation.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_msg</span><span class="p">,</span> <span class="n">writer_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reader_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">pretty_writers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">)),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pretty_readers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reader_schema</span><span class="p">)),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">writer_schema</span><span class="p">:</span> <span class="n">fail_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Writer&#39;s Schema: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pretty_writers</span>
    <span class="k">if</span> <span class="n">reader_schema</span><span class="p">:</span> <span class="n">fail_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reader&#39;s Schema: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pretty_readers</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">AvroException</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_msg</span><span class="p">)</span>
</pre></div>
</div>
<h3><i>DatumWriter(object)</i></h3>
<p>The class represents the DatumWriter interface which serializes Avro-encoded data into generic Python data object. The read and write utility functions can be defined within the DatumWriter class to validate the properties of the schema.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DatumWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_writer_schema</span> <span class="o">=</span> <span class="n">writer_schema</span>

</pre></div>
</div>
<h3><i>set_writer_schema(self, writer_schema)</i></h3>
<p>The function defines write properties of the schema.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">def</span> <span class="nf">set_writer_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_writer_schema</span> <span class="o">=</span> <span class="n">writer_schema</span>
  <span class="n">writer_schema</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer_</span>
                           <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">):</span>
    <span class="c1"># Validating datum</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">AvroTypeException</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>

</pre></div>
</div>
<h3><i>write_data(self, writer_schema, datum, encoder)</i></h3>
<p>The function encoded the writer schema to python data objects. Once the datum is encoded, it can be further decoded to match with the <code class="docutils literal notranslate"><span class="pre">writer_schema</span></code> for validation.</p>
<h4>Code Example</h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">):</span>
    <span class="c1"># function dispatch to write datum</span>
    <span class="k">if</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_null</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_boolean</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_utf8</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_int</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;long&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_long</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_float</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;double&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_double</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;bytes&#39;</span><span class="p">:</span>
      <span class="n">encoder</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_fixed</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;enum&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_enum</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_map</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;union&#39;</span><span class="p">,</span> <span class="s1">&#39;error_union&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_union</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;record&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;request&#39;</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">write_record</span><span class="p">(</span><span class="n">writer_schema</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">fail_msg</span> <span class="o">=</span> <span class="s1">&#39;Unknown type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">writer_schema</span><span class="o">.</span><span class="n">type</span>
      <span class="k">raise</span> <span class="n">schema</span><span class="o">.</span><span class="n">AvroException</span><span class="p">(</span><span class="n">fail_msg</span><span class="p">)</span>

</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref myst">Avro Schema Python APIs</span></p>
</div>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="schema.html"
       title="previous chapter">← Avro Schema</a>
  </li>
  <li class="next">
    <a href="datafile.html"
       title="next chapter">DataFile Reader and Writer Python APIs →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2022, Dev Prakash Sharma.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>